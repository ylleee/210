<!doctype html>
<html lang="ko">
<head>
    <meta charset="utf-8">
    <meta http-equiv='Content-Type' content='text/html'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>온라인평생교육원 전용 페이지</title>
    <link rel="stylesheet" href="/font-awesome-4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="stylesheets/style.css"/>
    <link rel="stylesheet" href="stylesheets/popup_layer.css"/>
    <link rel="stylesheet" href="stylesheets/contents_nav.css"/>
    <link rel="stylesheet" href="stylesheets/board.css"/>
    <link rel="stylesheet" href="stylesheets/pagination.css"/>

    <style>
        .user_profile_text {
            width:100%;
            padding-left: 0px;
            box-sizing: border-box;
            text-align: left;
        }

        .user_profile_text .title {
            margin-right: 100px;
            margin-left: 10px;
            width: 150px;
            display: inline-block;
            box-sizing: border-box;
            position: absolute;
            text-align:left;
            margin-top: 15px;
        }
        .user_profile_text .contents {
            width: 100%;
            padding-left: 130px;
            padding-right: 10px;
            display: inline-block;
            box-sizing: border-box;
            word-break: break-all;
        }

        .descript_top {
            text-align: center;
            margin-top: 8px;
            font-size : 14px;
        }

        @media only screen and (min-width: 0px) and (max-width: 770px){
            .descript_top {
                text-align: left;
                margin-top: 10px;
                font-size : 11px;
                margin-left: 10px;
                margin-right: 10px;
            }
        }
        @media only screen and (min-width: 0px) and (max-width: 450px){
            .descript_top {
                text-align: left;
                margin-top: 8px;
                font-size : 11px;
                margin-left: 10px;
                margin-right: 10px;
            }
        }
    </style>
</head>

<body>
<div class="div_course_center">
    <div class="HomeCourses2">
        <h1 style="text-align: center; padding: 10px 0px; border-bottom: 1px solid #DDD; margin-bottom: 10px">내용전문가 신청 페이지</h1>
        <div class ="descript_top">안녕하세요 온라인평생교육원입니다. 내용전문가 신청 시 아래 내용을 작성해주세요.</div>
        <div class ="descript_top">내용전문가 모집 공고문과 신청서 서식은 <a href="https://www.koreatech.ac.kr/kor/CMS/NoticeMgr/view.do?mCode=MN230&post_seq=25246&board_id=14" target="_blank">해당 사이트</a> 에서 신청해주세요.&nbsp;&nbsp;&nbsp;<a href="https://hiware.koreatech.ac.kr:8443/" target="_blank"> 
        <div class="btn-r">
            <div class="description">
                <p id="cp-signup-check" style="text-align: center; color:orangered"></p>
            </div>
        </div>

        <div class="input-form2">
            <form id="request-cp-form" method="post">
                <div class="user_profile_text">
                    <ul>
                        <li>

                            <div class="title"> 이름 </div>
                            <div class="contents">
                                <label style="display: none;" for="cp-signup-user-name"></label>
                                <input type="text" placeholder="이름을 입력해주세요" name="name" id="cp-signup-user-name">
                            </div>
                        </li>
                        <li>
                            <div class="title"> 기관명/부서 </div>
                            <div class="contents">
                                <label style="display: none;" for="cp-signup-user-company_name"></label>
                                <input type="text" placeholder="기관명을 입력해주세요" name="company_name" id="cp-signup-user-company_name">
                            </div>
                        </li>

                        <li>
                            <div class="title"> 이메일 </div>
                            <div class="contents">
                                <label style="display: none;" for="cp-signup-user-email"></label>
                                <input type="text" placeholder="이메일을 입력해주세요" name="email" id="cp-signup-user-email">
                            </div>
                        </li>
                        <li>
                            <div class="title"> 휴대폰 번호 </div>
                            <div class="contents">
                                <div class="id-box" id="cp-signup-phonenumber-box">
                                    <label style="display: none;" for="cp-signup-user-mobile-phone-number"></label>
                                    <input type="text" placeholder="예시 : 01012345678" name="mobile_phone_number" id="cp-signup-user-mobile-phone-number">
                                    <input class="btnChk" type="button" value="인증번호 요청">
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="title"> 휴대폰 인증번호 </div>
                            <div class="contents">
                                <div class="id-box" id="cp-signup-certification-box">
                                    <label style="display: none;" for="cp-signup-user-unique-number"></label>
                                    <input type="text" placeholder="인증번호를 입력해주세요" name="unique_number" id="cp-signup-user-unique-number">
                                    <input class="btnChk" type="button" value="인증번호 확인">
                                </div>
                            </div>
                        </li>
                        <li>
                            <div class="title"> 사용 종료 일자 </div>
                            <div class="contents">
                                <label style="display: none;" for="cp-signup-end-date"></label>
                                <input type="text" placeholder="예시 : 2019-12-31" name="end_date" id="cp-signup-end-date">
                            </div>
                        </li>
                        <li>
                            <div class="title"> IP주소 <a title="IP가 사설망인 경우 계정 신청이 무효처리 됩니다. 검색사이트에서 '내 아이피 확인'을 검색해보세요." href = "https://search.naver.com/search.naver?sm=top_hty&fbm=1&ie=utf8&query=%EB%82%B4+%EC%95%84%EC%9D%B4%ED%94%BC+%ED%99%95%EC%9D%B8" target="_blank"><i class="fa fa-question-circle-o" aria-hidden="true"></i></a> </div>
                            <div class="contents">
                                <label style="display: none;" for="cp-signup-ip"></label>
                                <input type="text" placeholder="IP 주소(공인 IP)를 입력해주세요" name="ipaddress" id="cp-signup-ip">
                            </div>
                        </li>
                        <li>
                            <div class="title"> 활용 목적 </div>
                            <div class="contents">
                                <label style="display: none;" for="cp-signup-purpose"></label>
                                <input type="text" placeholder="활용 목적 혹은 사업명을 입력해주세요" name="purpose" id="cp-signup-purpose">
                            </div>
                        </li>

                        <li>
                            <div class="title"> 담당 연구원 </div>
                            <div class="contents">
                                <label style="display: none;" for="olei_researcher_list"></label>
                                <select name="olei_researcher_filter" id="olei_researcher_filter">
                                </select>
                            </div>
                        </li>

                        <li id = "li_hiware" name = "li_hiware" >
                            <div class="title"> Hiware 계정 <a title="Hiware 계정이 있어야 FTP 계정을 생성할 수 있습니다." href = "https://hiware.koreatech.ac.kr:8443" target="_blank"><i class="fa fa-question-circle-o" aria-hidden="true"></i></a> </div>
                            <div class="contents">
                                <label style="display: none;" for="cp-signup-hiware"></label>
                                <input type="text" placeholder="Hiware 사이트에서 신청한 Hiware 아이디를 입력해주세요." name="hiware" id="cp-signup-hiware">
                            </div>
                        </li>


                        <li>
                            <input type="submit" value="FTP 신청하기">
                        </li>
                    </ul>
                </div>
            </form>
        </div>

    </div>
</div>

<div class="footer_bottom">
    <p>COPYRIGHT KOREA UNIVERSITY OF TECHNOLOGY AND EDUCATION. ALL RIGHTS RESERVED.</p>
</div>

<script src="http://code.jquery.com/jquery-2.2.1.min.js"></script>

<script>
    var certification_phone = false;
    var certification_id = false;

    $(document).ready(function () {

        $.ajax({
            type: "POST",
            async: false,
            url: "/getOleiResearcherList",
            success: function (args) {
                if (args['is_success']) {
                    education_level = args;
                    for(var i=0; i<args['data_list'].length; i++) {
                        $('select[name=olei_researcher_filter]').append("<option value=\"" + args['data_list'][i]['no'] + "\">" + args['data_list'][i]['researcher'] + "</option>");
                    }
                    $("#system_filter option:eq(0)").attr("selected", "selected");

                } else {
                    //alert(args['error_message']);
                    debugAjaxReceviedError("getOleiResearcherList", args['error_message']);
                }
            },
            error: function (request,status,error) {
                alert("ajax response error \ncode:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
            }
        });

    })


    $('#cp-signup-phonenumber-box').keydown(function (e) {
        var k = e.keyCode;
        if ((90 >= k && k >= 65) // a ~ z
            || (111 >= k && k >= 106) // keypad operator
            || (192 >= k && k >= 186) // -,=./;
            || (222 >= k && k >= 219) // ']\[
            || k == 32 // space bar
            || k == 59 // FF ;
            || k == 61 // FF =
            || k == 173 // FF -
        ) {
            e.preventDefault();
        }
    });

    function checkIP(strIP) {
        var expUrl = /^(1|2)?\d?\d([.](1|2)?\d?\d){3}$/;
        return expUrl.test(strIP);
    }

    function checkPrivateIP(strIP) {
        var split_ip_addr = strIP.split('.');
        if (split_ip_addr.length > 0) {
            if (split_ip_addr[0] === '192' || split_ip_addr[0] === '172') {
                if (split_ip_addr[0] === '192') {
                    return Number(split_ip_addr[1]) !== 168;
                } else if (split_ip_addr[0] === '172') {
                    return !(Number(split_ip_addr[1]) >= 16 && Number(split_ip_addr[1]) <= 31);
                }
            }
        }
    }

    function validateEmail(email) {
        var re = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return re.test(email);
    }

    function isValidDate(dateString) {
        var regEx = /^\d{4}-\d{2}-\d{2}$/;
        if(!dateString.match(regEx)) return false;  // Invalid format
        var d = new Date(dateString);
        if(!d.getTime()) return false; // Invalid date (or this could be epoch)
        return d.toISOString().slice(0,10) === dateString;
    }

    function debugAjaxReceviedError(title, message) {
        alert(message);
    }

</script>

<script>

    //인증번호 요청 버튼
    $("#cp-signup-phonenumber-box .btnChk").click(function () {
        var phone = $('#cp-signup-phonenumber-box input[type=text]').val();
        phone = phone.replace(/-/gi, '');
        if (phone.length < 10 || phone.length > 11) {
            $('#cp-signup-check').text('휴대폰 번호를 확인해주세요.');
            alert($('#cp-signup-check').text());
        }  else {
            var url = "/setCertificationNoForStep";
            var params = "phone=" + phone;

            $.ajax({
                type: "POST",
                url: url,
                data: params,
                success: function (args) {
                    if (args['is_success']) {
                        $('#cp-signup-check').text('인증번호가 전송되었습니다.');
                        alert($('#cp-signup-check').text());

                        $("#cp-signup-user-mobile-phone-number").attr("readonly",false).attr("disabled",false);
                        $("#cp-signup-user-unique-number").attr("readonly",false).attr("disabled",false);
                    } else {
                        $('#cp-signup-check').text(args['error_message']);
                        //alert($('#cp-signup-check').text());
                        debugAjaxReceviedError("setCertificationNoForStep", args['error_message']);
                    }
                },
                error: function (request,status,error) {
                    alert("ajax response error \ncode:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                }
            });
        }

    });

    //휴대폰 인증번호 확인 버튼
    $("#cp-signup-certification-box .btnChk").click(function () {
        var phone = $('#cp-signup-phonenumber-box input[type=text]').val();
        var certification = $('#cp-signup-certification-box input[type=text]').val();
        var url = "/getCertificationNo";
        var params = "unique_number=" + certification + "&phone=" + phone;

        if(certification.length === 0) {
            $('#cp-signup-check').text('인증번호를 입력하세요.');
            alert($('#cp-signup-check').text());
            certification_phone = false;
        } else if(certification.length !== 6) {
            $('#cp-signup-check').text('인증번호를 확인하세요.');
            alert($('#cp-signup-check').text());
            certification_phone = false;
        } else {
            $.ajax({
                type: "POST",
                url: url,
                data: params,
                success: function (args) {
                    if (args['is_success']) {
                        //$('#cp-signup-check').text('인증번호가 확인되었습니다.');
                        alert('인증번호가 확인되었습니다.');
                        $('#cp-signup-check').text('');
                        $("#cp-signup-user-mobile-phone-number").attr("readonly",true).attr("disabled",false);
                        $("#cp-signup-user-unique-number").attr("readonly",true).attr("disabled",false);

                        $('#cp-signup-phonenumber-box input[type=text]').change(function () {
                            if(phone !== $(this).val()) {
                                certification_phone = false;
                            } else {
                                certification_phone = true;
                            }
                        });
                        certification_phone = true;
                    } else {
                        $('#cp-signup-check').text(args['error_message']);
                        debugAjaxReceviedError("getCertificationNoForStep", args['error_message']);

                        $("#cp-signup-user-mobile-phone-number").attr("readonly",false).attr("disabled",false);
                        $("#cp-signup-user-unique-number").attr("readonly",false).attr("disabled",false);
                    }
                },
                error: function (request,status,error) {
                    alert("ajax response error \ncode:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                }
            });
        }


    });

    //신청하기 버튼
    $('#request-cp-form input[type=submit]').click(function (e) {

        if($('#request-cp-form input[name=name]').val() === '') {
            $('#cp-signup-check').text('이름을 입력하세요.');
            alert($('#cp-signup-check').text());
        }
        else if($('#request-cp-form input[name=company_name]').val() === ''){
            $('#cp-signup-check').text('기관명를 입력하세요.');
            alert($('#cp-signup-check').text());
        }
        else if(validateEmail($('#request-cp-form input[name=email]').val()) === false){
            $('#cp-signup-check').text('잘못된 이메일 형식입니다.');
            alert($('#cp-signup-check').text());
        }
        else if($('#request-cp-form input[name=mobile_phone_number]').val() === ''){
            $('#cp-signup-check').text('휴대폰번호를 입력하세요.');
            alert($('#cp-signup-check').text());
        }
        else if($('#request-cp-form input[name=unique_number]').val() === ''){
            $('#cp-signup-check').text('인증번호를 입력하세요.');
            alert($('#cp-signup-check').text());
        }
        else if(isValidDate($('#request-cp-form input[name=end_date]').val()) === false){
            $('#cp-signup-check').text('사용 종료 일자를 올바른 날짜 혹은 형식을 YYYY-MM-DD으로 작성해야 합니다.');
            alert($('#cp-signup-check').text());
        }
        else if($('#request-cp-form input[name=end_date]').val() === ''){
            $('#cp-signup-check').text('사용 종료일자를 입력하세요.');
            alert($('#cp-signup-check').text());
        }
        else if($('#request-cp-form input[name=ipaddress]').val() === ''){
            $('#cp-signup-check').text('사용 IP 주소를 입력하세요.');
            alert($('#cp-signup-check').text());
        }
        else if(checkIP($('#request-cp-form input[name=ipaddress]').val()) === false) {
            $('#cp-signup-check').text('IP 주소 형식이 잘못되었습니다.');
            alert($('#cp-signup-check').text());
        }
        else if(checkPrivateIP($('#request-cp-form input[name=ipaddress]').val()) === false) {
            $('#cp-signup-check').text('사설 IP입니다. 공인 IP 확인 방법은 IP 주소 제목의 ? 아이콘 클릭');
            alert($('#cp-signup-check').text());
        }
        else if($('#request-cp-form input[name=purpose]').val() === ''){
            $('#cp-signup-check').text('활용 목적을 입력하세요.');
            alert($('#cp-signup-check').text());
        }
        else if(!certification_phone) {
            $('#cp-signup-check').text('휴대폰 인증 번호를 확인해주세요.');
            alert($('#cp-signup-check').text());
        }
        else if($('#request-cp-form input[name=hiware]').val() === ''){
            $('#cp-signup-check').text('Hiware 계정을 입력하세요.');
            alert($('#cp-signup-check').text());
        }


        else {

            var formData = $("#request-cp-form").serialize();

            $.ajax({
                type: "POST",
                async: false,
                url: "/setCPRequest",
                data: formData,
                success: function (args) {
                    if (args['is_success']) {
                        alert('CP 계정 신청이 완료되었습니다. \n신청한 이메일로 결과 알림 드리겠습니다.')
                        location.href = '/cp';
                    } else {
                        //alert(args['error_message']);
                        //debugAjaxReceviedError("setStepAdminRequest", args['error_message']);

                        $('#cp-signup-check').text(args['error_message']);
                        alert($('#cp-signup-check').text());

                        $('#request-cp-form input[name=mobile_phone_number]').val('')
                        $('#request-cp-form input[name=unique_number]').val('')
                        certification_id = false;
                        $("#cp-signup-user-mobile-phone-number").attr("readonly",false).attr("disabled",false);
                        $("#cp-signup-user-unique-number").attr("readonly",false).attr("disabled",false);

                        certification_phone = false;
                    }
                },
                error: function (request,status,error) {
                    alert("ajax response error \ncode:"+request.status+"\n"+"message:"+request.responseText+"\n"+"error:"+error);
                }
            });

        }
        e.preventDefault();
        return false;
    });
</script>

</body>
</html>
